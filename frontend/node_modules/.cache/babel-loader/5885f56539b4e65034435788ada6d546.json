{"ast":null,"code":"var _jsxFileName = \"/home/messiasbarreto/Documents/Projects/Personal/ReactJs/todolistweb/src/Contexts/Auth/AuthContextProvider.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport { getRefreshToken, setRefreshToken, setToken } from \"../../hooks/localstorage\";\nimport { useApi } from \"../../hooks/useApi\";\nimport { AuthContext } from \"./AuthContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState(null);\n  const api = useApi();\n\n  const signin = async (login, password) => {\n    const data = await api.singin(login, password);\n\n    if (data.token) {\n      setUser({\n        id: data.user.data.id,\n        name: data.user.data.name,\n        email: data.user.data.email,\n        login: data.user.data.login\n      });\n      setToken(data.token);\n      setRefreshToken(data.refresh_token);\n      return true;\n    }\n\n    return false;\n  };\n\n  const signout = async () => {\n    await api.logout();\n    setUser(null);\n  };\n\n  const refreshToken = async () => {\n    const refresh = getRefreshToken();\n\n    if (refresh) {\n      const token = await api.validateToken(refresh);\n      setToken(token);\n      setUser(token.user.userToken);\n    }\n  };\n\n  useEffect(() => {\n    refreshToken();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      signin,\n      signout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 9\n  }, this);\n};\n\n_s(AuthProvider, \"/S2GVsTmHFLNzZ6vepIVAoo+nTk=\", false, function () {\n  return [useApi];\n});\n\n_c = AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["useEffect","useState","getRefreshToken","setRefreshToken","setToken","useApi","AuthContext","AuthProvider","children","user","setUser","api","signin","login","password","data","singin","token","id","name","email","refresh_token","signout","logout","refreshToken","refresh","validateToken","userToken"],"sources":["/home/messiasbarreto/Documents/Projects/Personal/ReactJs/todolistweb/src/Contexts/Auth/AuthContextProvider.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\"\nimport { getRefreshToken, getToken, setRefreshToken, setToken } from \"../../hooks/localstorage\"\nimport { useApi } from \"../../hooks/useApi\"\nimport { User } from \"../../Types/User\"\nimport { AuthContext } from \"./AuthContext\"\n\nexport const AuthProvider = ({ children }: {children: JSX.Element}) => {\n    const [user, setUser] = useState<User | null>(null)\n    const api = useApi();\n\n    const signin = async (login: string, password: string) => {\n        const data = await api.singin(login, password);\n        if(data.token) {\n            setUser({\n                id: data.user.data.id,\n                name: data.user.data.name,\n                email: data.user.data.email,\n                login: data.user.data.login\n            });\n\n            setToken(data.token);\n            setRefreshToken(data.refresh_token);\n            return true;\n        }\n        return false;\n    }\n\n    const signout = async () => {\n        await api.logout();\n        setUser(null);\n    }\n\n    const refreshToken = async () => {\n        const refresh = getRefreshToken();\n        if(refresh) {\n            const token = await api.validateToken(refresh);\n            setToken(token); \n            setUser(token.user.userToken)\n        }\n    }\n\n    useEffect(() => {\n        refreshToken()\n    }, [])\n\n    return (\n        <AuthContext.Provider value={{ user, signin, signout }}>\n            {children}\n        </AuthContext.Provider>\n    )\n}"],"mappings":";;;AAAA,SAASA,SAAT,EAAoBC,QAApB,QAAoC,OAApC;AACA,SAASC,eAAT,EAAoCC,eAApC,EAAqDC,QAArD,QAAqE,0BAArE;AACA,SAASC,MAAT,QAAuB,oBAAvB;AAEA,SAASC,WAAT,QAA4B,eAA5B;;AAEA,OAAO,MAAMC,YAAY,GAAG,QAA2C;EAAA;;EAAA,IAA1C;IAAEC;EAAF,CAA0C;EACnE,MAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBT,QAAQ,CAAc,IAAd,CAAhC;EACA,MAAMU,GAAG,GAAGN,MAAM,EAAlB;;EAEA,MAAMO,MAAM,GAAG,OAAOC,KAAP,EAAsBC,QAAtB,KAA2C;IACtD,MAAMC,IAAI,GAAG,MAAMJ,GAAG,CAACK,MAAJ,CAAWH,KAAX,EAAkBC,QAAlB,CAAnB;;IACA,IAAGC,IAAI,CAACE,KAAR,EAAe;MACXP,OAAO,CAAC;QACJQ,EAAE,EAAEH,IAAI,CAACN,IAAL,CAAUM,IAAV,CAAeG,EADf;QAEJC,IAAI,EAAEJ,IAAI,CAACN,IAAL,CAAUM,IAAV,CAAeI,IAFjB;QAGJC,KAAK,EAAEL,IAAI,CAACN,IAAL,CAAUM,IAAV,CAAeK,KAHlB;QAIJP,KAAK,EAAEE,IAAI,CAACN,IAAL,CAAUM,IAAV,CAAeF;MAJlB,CAAD,CAAP;MAOAT,QAAQ,CAACW,IAAI,CAACE,KAAN,CAAR;MACAd,eAAe,CAACY,IAAI,CAACM,aAAN,CAAf;MACA,OAAO,IAAP;IACH;;IACD,OAAO,KAAP;EACH,CAfD;;EAiBA,MAAMC,OAAO,GAAG,YAAY;IACxB,MAAMX,GAAG,CAACY,MAAJ,EAAN;IACAb,OAAO,CAAC,IAAD,CAAP;EACH,CAHD;;EAKA,MAAMc,YAAY,GAAG,YAAY;IAC7B,MAAMC,OAAO,GAAGvB,eAAe,EAA/B;;IACA,IAAGuB,OAAH,EAAY;MACR,MAAMR,KAAK,GAAG,MAAMN,GAAG,CAACe,aAAJ,CAAkBD,OAAlB,CAApB;MACArB,QAAQ,CAACa,KAAD,CAAR;MACAP,OAAO,CAACO,KAAK,CAACR,IAAN,CAAWkB,SAAZ,CAAP;IACH;EACJ,CAPD;;EASA3B,SAAS,CAAC,MAAM;IACZwB,YAAY;EACf,CAFQ,EAEN,EAFM,CAAT;EAIA,oBACI,QAAC,WAAD,CAAa,QAAb;IAAsB,KAAK,EAAE;MAAEf,IAAF;MAAQG,MAAR;MAAgBU;IAAhB,CAA7B;IAAA,UACKd;EADL;IAAA;IAAA;IAAA;EAAA,QADJ;AAKH,CA5CM;;GAAMD,Y;UAEGF,M;;;KAFHE,Y"},"metadata":{},"sourceType":"module"}